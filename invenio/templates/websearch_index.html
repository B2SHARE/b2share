{#
## This file is part of Invenio.
## Copyright (C) 2012 CERN.
##
## Invenio is free software; you can redistribute it and/or
## modify it under the terms of the GNU General Public License as
## published by the Free Software Foundation; either version 2 of the
## License, or (at your option) any later version.
##
## Invenio is distributed in the hope that it will be useful, but
## WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
## General Public License for more details.
##
## You should have received a copy of the GNU General Public License
## along with Invenio; if not, write to the Free Software Foundation, Inc.,
## 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA.
#}
{% from "_formhelpers.html" import render_filter_form with context %}
{% from "websearch_helpers.html" import collection_tree, portalbox_sidebar, search_also, search_form, search_form_javascript  with context %}
{% extends "page.html" %}
{# set title = collection.name_ln if collection.id > 1 else None #}
{% set title = None %}

{%- set portalboxes = dict() -%}
{%- for k,l in collection.portalboxes_ln|groupby('position') -%}
  {%- do portalboxes.update({k:l}) -%}
{%- endfor -%}

{% block header %}
  {{ super() }}
  {% css 'css/simplestore-style.css' %}
  {% js "js/websearch_typeahead.js" %}
  {% js "js/bootstrap-select.js" %}
{% endblock %}

{% block title %}
  {{ portalboxes.tp }}
  {{ super() }}
  {{ portalboxes.te }}
{% endblock %}

{% macro collection_records(collection) %}
<style>
.websearch .nav > li > ul > li {
  float: left;
}
.websearch .nav > li > a {
  white-space: nowrap;
}
.websearch .nav > li > a:hover {
  background-color: inherit;
}
.websearch ul.nav > li > ul {
  clear: both;
}
.websearch ul.nav > li > ul > li {
  display: inline;
}
.websearch ul.nav > li > ul > li > a {
  display: inline;
}
.websearch .badge {
  font-size: 80%;
}

.collection ul.nav-list {
  padding-left: 0px;
}

.collection ul.nav-list ul.nav-list {
  font-size: 90%;
}

.collection ul ul li a {
  color: #333;
  opacity: 0.8;
}

.collection .badge {
  opacity:0.6;
  font-size:80%;
}

.collection ul ul .badge {
  color: #333;
  background-color: #EEE;
  border: 1px solid #999;
}

</style>

{{ search_form(collection) }}
{% endmacro %}

{% block body %}

{% if collection.is_restricted %}
  {{ collection_records(collection) }}
{% else %}
  {% cache 24*60*60, collection.name, g.ln %}
    {{ collection_records(collection) }}
  {% endcache %}
{% endif %}
  <div class="row">
    <div class="span4">
      <img src="img/tome.jpg"/>
      <span class="attribution">Image courtesy of <a href="http://www.flickr.com/photos/frisno/">Frisno Bostr√∂m</a></span>
    </div>
    <div class="span8">
      <div class="jumbotron">
        <h1>Reliable and Durable Storage of Research Data</h1>

        <p class="lead">The EUDAT SimpleStore service provides a quick and easy mechanism for storage of research data and output in a reliable and durable manner.</p>
        <p class="maintext">The SimpleStore is currently in an early testing phase. Users are encouraged to sign up and test the service, but please be aware that is not yet ready for production use.</p> 
        <p class="maintext">Please contact <a href="mailto:livenson@kth.se">livenson@kth.se</a> with any questions or feedback.</p>
        <a class="btn btn-large btn-success" href="{{ url_for("youraccount.register") }}">Sign up now</a>
      </div>
    </div>
  </div>


{% endblock %}

{% block javascript %}
<script>
(function($) {
  $('[rel=tooltip]').tooltip();
})(jQuery);
</script>
{{ search_form_javascript(collection)}}
{% endblock %}
