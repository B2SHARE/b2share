
{# would have been easier if wtf bs let me pass in css classes to horizontal_field #}
{{ form.csrf_token }}
{%- macro meta_field(f) %}
<div class="control-group {% if f.errors %}error{% endif %}">
  {{f.label(class="control-label meta-label")}} {%- if f.flags.required -%}<span style="color: red;">&nbsp;*</span>{%- endif %}
    {{f(**kwargs)|safe}}
  <div class="controls">

    {%- if f.errors %}
      {%- for error in f.errors %}
        <p class="help-block">{{error}}</p>
      {%- endfor %}
    {%- endif %}
  {%- if f.description -%}
  {# <p class="help-block">{{f.description|safe}}</p> #}
  <a class="description" href="#"><button type="button" class="btn btn-info disabled">?</button><span>{{f.description}}</span></a>
  {%- endif %}
  </div>
</div>
{% endmacro %}

{% for s in metadata.fieldsets %}
  <fieldset>
    <legend>{{ s.name }}</legend>

    {% for f in s.basic_fields %}
      {{ meta_field(getattr(form, f)) }}
    {% endfor %}

    {% if s.optional_fields %}
      <button type="button" class="btn btn-success" data-toggle="collapse" data-target="#adv-fields-{{ s.name }}">
                    Add more details?
      </button>
 
      <div id="adv-fields-{{ s.name }}" class="collapse"> 

        {% for f in s.optional_fields %}
          {{ meta_field(getattr(form, f)) }}
        {% endfor %}
      </div>
    {% endif %}

  </fieldset>
{% endfor %}
<script type="text/javascript">
  $('.switch')['bootstrapSwitch']();
</script>
