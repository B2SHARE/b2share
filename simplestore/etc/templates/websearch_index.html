{#
## This file is part of Invenio.
## Copyright (C) 2012 CERN.
## Portions Copyright (C) 2013 EPCC, The University of Edinburgh.
##
## Invenio is free software; you can redistribute it and/or
## modify it under the terms of the GNU General Public License as
## published by the Free Software Foundation; either version 2 of the
## License, or (at your option) any later version.
##
## Invenio is distributed in the hope that it will be useful, but
## WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
## General Public License for more details.
##
## You should have received a copy of the GNU General Public License
## along with Invenio; if not, write to the Free Software Foundation, Inc.,
## 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA.
#}
{% from "_formhelpers.html" import render_filter_form with context %}
{% from "websearch_helpers.html" import collection_tree, portalbox_sidebar, search_also, search_form, search_form_javascript  with context %}
{% extends "page.html" %}
{# set title = collection.name_ln if collection.id > 1 else None #}
{% set title = None %}


{%- set portalboxes = dict() -%}
{%- for k,l in collection.portalboxes_ln|groupby('position') -%}
    {%- do portalboxes.update({k:l}) -%}
{%- endfor -%}

{% block header %}
    {{ super() }}
    {% css 'css/websearch_index.css' %}
    {% css 'css/simplestore-style.css' %}
    {% js "js/websearch_typeahead.js" %}
    {% js "js/bootstrap-select.js" %}
{% endblock %}

{% block title %}
    {{ portalboxes.tp }}
    {{ super() }}
    {{ portalboxes.te }}
{% endblock %}

{% macro collection_records(collection) %}

{{ search_form(collection) }}
{% endmacro %}

{% block body %}

{% if collection.is_restricted %}
    {{ collection_records(collection) }}
{% else %}
    {% cache 24*60*60, collection.name, g.ln %}
        {{ collection_records(collection) }}
    {% endcache %}
{% endif %}
    <div class="row websearch">
        <div class="span4">
            <button class="deposit-btn">DEPOSIT</button>
            <h3 class="deposits_title">Latest Deposits</h3>
        </div>
        <div class="span8">
            <h2 class="title">
                <img src="img/bee.png" alt="Bee"></img>STORE AND SHARE YOUR RESEARCH DATA
            </h2>

            <p class="bigtext">A user-friendly, secure, robust, reliable and trusted service to share and store your research data <em>adding value to your research data by assigning Persistent Identifiers to ensure long-lasting access and reference</em></p>

            <p class="bigtext"><strong>Deposit your data</strong> via the generic interface or select a community extension including specific metadata fields</p>

            <p class="bigtext"><strong>Search for data</strong></p>

            <p class="bigtext"><strong>Do you belong to a scientific community?</strong> Brand and create your own community collection with specific metadata fields customised for your  field</p>

            {% if unregistered %}
            <a class="btn btn-large btn-success" href="{{ url_for("youraccount.register") }}">Sign up now</a>
            {% endif %}
        </div>
    </div>


{% endblock %}

{% block javascript %}
<script>
(function($) {
    $('[rel=tooltip]').tooltip();
})(jQuery);
</script>
{{ search_form_javascript(collection)}}
{% endblock %}
